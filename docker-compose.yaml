version: '3.8'

services:
  # 1. API 서버 컨테이너 정의 (FastAPI 웹 서비스)
  api:
    build: .
    # FastAPI 실행을 위해 Uvicorn을 사용하도록 명령어 수정
    # 'app:app'은 프로젝트의 진입 파일 이름과 FastAPI 인스턴스 이름에 따라 수정될 수 있습니다.
    # (예: app.py 파일에 app = FastAPI()로 정의된 경우)
    command: uvicorn app:app --host 0.0.0.0 --port 8000
    
    # 외부 포트 80을 내부 컨테이너 포트 8000으로 연결
    ports:
      - "80:8000"
    
    # RDS 환경 변수 파일 사용
    env_file:
      - .env
      
    # 컨테이너가 멈추면 자동으로 재시작
    restart: always

  # 2. 크롤러 컨테이너 정의 (데이터 수집)
  crawler:
    build: .
    # 크롤러 스크립트 실행 명령 (파일 이름이 crawler.py인지 확인)
    command: python crawler.py
    
    # RDS 환경 변수 파일 사용
    env_file:
      - .env